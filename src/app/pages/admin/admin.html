<div class="admin-container">
  <div class="admin-header">
    <div class="header-content">
      <div>
        <h1>Panneau d'administration</h1>
        <p class="subtitle">Gestion des demandes de contact et r√©servations</p>
      </div>
      <div class="user-menu">
        <span class="user-email">{{ getUserEmail() }}</span>
        <button class="btn-logout" (click)="logout()">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M3 1a1 1 0 00-1 1v12a1 1 0 001 1h8a1 1 0 001-1V9.5a.5.5 0 00-1 0V13H3V2h8v3.5a.5.5 0 001 0V2a1 1 0 00-1-1H3z"/>
            <path d="M13.854 8.354l-2.5 2.5a.5.5 0 01-.708-.708L12.293 8.5H6.5a.5.5 0 010-1h5.793l-1.647-1.646a.5.5 0 01.708-.708l2.5 2.5a.5.5 0 010 .708z"/>
          </svg>
          D√©connexion
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Chargement des donn√©es...</p>
  </div>

  <!-- Not Configured Warning -->
  <div *ngIf="!loading && !isConfigured" class="warning-box">
    <h2>‚ö†Ô∏è Base de donn√©es non configur√©e</h2>
    <p>
      La base de donn√©es Supabase n'est pas encore configur√©e.
      Veuillez suivre les instructions dans le fichier <code>SUPABASE_SETUP.md</code>
      pour configurer votre base de donn√©es.
    </p>
    <ol>
      <li>Cr√©er un projet Supabase</li>
      <li>Ex√©cuter le sch√©ma SQL</li>
      <li>Mettre √† jour les fichiers d'environnement avec vos identifiants</li>
      <li>Red√©marrer le serveur de d√©veloppement</li>
    </ol>
  </div>

  <!-- Admin Panel (only show if configured) -->
  <div *ngIf="!loading && isConfigured" class="admin-content">

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üìû</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.totalContacts }}</div>
          <div class="stat-label">Demandes de contact</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üìÖ</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.totalBookings }}</div>
          <div class="stat-label">R√©servations</div>
        </div>
      </div>

      <div class="stat-card urgent">
        <div class="stat-icon">üö®</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.urgentContacts }}</div>
          <div class="stat-label">Demandes urgentes</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">‚è≥</div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.pendingBookings }}</div>
          <div class="stat-label">R√©servations en attente</div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button
        class="tab"
        [class.active]="activeTab === 'bookings'"
        (click)="activeTab = 'bookings'">
        R√©servations ({{ stats.totalBookings }})
      </button>
      <button
        class="tab"
        [class.active]="activeTab === 'contacts'"
        (click)="activeTab = 'contacts'">
        Contacts ({{ stats.totalContacts }})
      </button>
      <button
        class="tab urgent-tab"
        [class.active]="activeTab === 'urgent'"
        (click)="activeTab = 'urgent'">
        üö® Urgent ({{ stats.urgentContacts }})
      </button>
    </div>

    <!-- Booking Requests Tab -->
    <div *ngIf="activeTab === 'bookings'" class="tab-content">
      <div *ngIf="bookingRequests.length === 0" class="empty-state">
        <p>Aucune r√©servation pour le moment.</p>
      </div>

      <div class="table-container" *ngIf="bookingRequests.length > 0">
        <table class="data-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Client</th>
              <th>Service</th>
              <th>Date souhait√©e</th>
              <th>Heure</th>
              <th>Total</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let booking of bookingRequests">
              <td>{{ formatDate(booking.created_at) }}</td>
              <td>
                <div class="client-info">
                  <strong>{{ booking.first_name }} {{ booking.last_name }}</strong>
                  <small>{{ booking.email }}</small>
                  <small>{{ booking.phone }}</small>
                </div>
              </td>
              <td>
                <div class="service-info">
                  <strong>{{ booking.service_name }}</strong>
                  <small>{{ booking.frequency }}</small>
                </div>
              </td>
              <td>{{ booking.preferred_date }}</td>
              <td>{{ booking.preferred_time }}</td>
              <td><strong>{{ formatCurrency(booking.total) }}</strong></td>
              <td>
                <span class="status-badge" [class]="getStatusBadgeClass(booking.status)">
                  {{ booking.status || 'pending' }}
                </span>
              </td>
              <td>
                <select
                  [value]="booking.status || 'pending'"
                  (change)="updateBookingStatus(booking.id!, $any($event.target).value)"
                  class="status-select">
                  <option value="pending">En attente</option>
                  <option value="contacted">Contact√©</option>
                  <option value="confirmed">Confirm√©</option>
                  <option value="completed">Compl√©t√©</option>
                  <option value="cancelled">Annul√©</option>
                </select>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Contact Submissions Tab -->
    <div *ngIf="activeTab === 'contacts'" class="tab-content">
      <div *ngIf="contactSubmissions.length === 0" class="empty-state">
        <p>Aucune demande de contact pour le moment.</p>
      </div>

      <div class="table-container" *ngIf="contactSubmissions.length > 0">
        <table class="data-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Client</th>
              <th>Service demand√©</th>
              <th>Message</th>
              <th>Urgent</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let contact of contactSubmissions" [class.urgent-row]="contact.urgent_request">
              <td>{{ formatDate(contact.created_at) }}</td>
              <td>
                <div class="client-info">
                  <strong>{{ contact.first_name }} {{ contact.last_name }}</strong>
                  <small>{{ contact.email }}</small>
                  <small>{{ contact.phone }}</small>
                </div>
              </td>
              <td>{{ contact.service_type }}</td>
              <td>
                <div class="message-preview">
                  {{ contact.message }}
                </div>
              </td>
              <td>
                <span *ngIf="contact.urgent_request" class="urgent-badge">üö® 48h</span>
                <span *ngIf="!contact.urgent_request">-</span>
              </td>
              <td>
                <span class="status-badge" [class]="getStatusBadgeClass(contact.status)">
                  {{ contact.status || 'pending' }}
                </span>
              </td>
              <td>
                <select
                  [value]="contact.status || 'pending'"
                  (change)="updateContactStatus(contact.id!, $any($event.target).value)"
                  class="status-select">
                  <option value="pending">En attente</option>
                  <option value="contacted">Contact√©</option>
                  <option value="resolved">R√©solu</option>
                </select>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Urgent Requests Tab -->
    <div *ngIf="activeTab === 'urgent'" class="tab-content">
      <div *ngIf="urgentContacts.length === 0" class="empty-state">
        <p>‚úÖ Aucune demande urgente non r√©solue!</p>
      </div>

      <div class="table-container" *ngIf="urgentContacts.length > 0">
        <div class="urgent-warning">
          ‚ö†Ô∏è Ces demandes n√©cessitent une r√©ponse dans les 48 heures
        </div>

        <table class="data-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Client</th>
              <th>Service demand√©</th>
              <th>Message</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let contact of urgentContacts" class="urgent-row">
              <td>{{ formatDate(contact.created_at) }}</td>
              <td>
                <div class="client-info">
                  <strong>{{ contact.first_name }} {{ contact.last_name }}</strong>
                  <small>{{ contact.email }}</small>
                  <small>{{ contact.phone }}</small>
                </div>
              </td>
              <td>{{ contact.service_type }}</td>
              <td>
                <div class="message-preview">
                  {{ contact.message }}
                </div>
              </td>
              <td>
                <span class="status-badge" [class]="getStatusBadgeClass(contact.status)">
                  {{ contact.status || 'pending' }}
                </span>
              </td>
              <td>
                <select
                  [value]="contact.status || 'pending'"
                  (change)="updateContactStatus(contact.id!, $any($event.target).value)"
                  class="status-select">
                  <option value="pending">En attente</option>
                  <option value="contacted">Contact√©</option>
                  <option value="resolved">R√©solu</option>
                </select>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
